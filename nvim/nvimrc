" Plugins

call plug#begin()

" Misc
Plug 'Shougo/vimproc.vim', { 'do': 'make' }
Plug 'xolox/vim-misc'

" File navigation and search
Plug 'scrooloose/nerdtree'
Plug 'jistr/vim-nerdtree-tabs'
Plug 'rking/ag.vim'
Plug 'ctrlpvim/ctrlp.vim'
Plug 'reedes/vim-wheel'

" Look and feel
Plug 'chriskempson/base16-vim'
Plug 'frankier/neovim-colors-solarized-truecolor-only'
Plug 'chriskempson/vim-tomorrow-theme'
Plug 'morhetz/gruvbox'

" Tmux
Plug 'christoomey/vim-tmux-navigator'
Plug 'tmux-plugins/vim-tmux'
Plug 'tmux-plugins/vim-tmux-focus-events'
Plug 'epeli/slimux'

" Text management
Plug 'junegunn/vim-easy-align'
Plug 'godlygeek/tabular'
Plug 'ervandew/supertab'
Plug 'scrooloose/nerdcommenter'
Plug 'jceb/vim-orgmode'

" Language agnostic
"Plug 'scrooloose/syntastic'             " syntax checker
Plug 'neomake/neomake'
Plug 'Shougo/deoplete.nvim'

" Scala
Plug 'derekwyatt/vim-scala', { 'for': 'scala' }
"Plug 'ensime/ensime-vim'

" Haskell
Plug 'raichoo/haskell-vim', { 'for': 'haskell' }
Plug 'dag/vim2hs', { 'for': 'haskell' }
Plug 'eagletmt/ghcmod-vim'
Plug 'eagletmt/neco-ghc'


" Could be tried
" 'tacahiroy/ctrlp-funky'
" 'guns/vim-sexp' for s-expressions, might be useful for clojure.
" 'tpope/vim-sexp-mappings-for-regular-people'
" 'kshenoy/vim-signature' another approach for handling bookmarks.
" 'vim-scripts/utl.vim' URL-based hyperlinking to plain text ...

call plug#end()



syntax on
syntax enable
let $NVIM_TUI_ENABLE_TRUE_COLOR=1
let g:solarized_termcolors=256

" Colors
set termguicolors
set background=dark
colorscheme base16-solarized-light



" UI Config

filetype on
filetype plugin indent on

highlight Comment gui=bold,italic
highlight cursorline gui=bold cterm=bold

set guifont=Monaco:h14
set guioptions-=r                                       " Remove the right scrollbar
set title						" show title in console title bar.
set cursorline						" highlights line
set cursorcolumn					" highlights column
set guitablabel=%t					" Tab headings
set guitabtooltip=%F					" Tab headings
set number                                              " read "number_relativenumber" in help
set linespace=0						" space it out a little more (easier to read).
set cmdheight=1						" the command bar is 2 high.
set autoindent
set smartindent
set showmode						" show current-mode.
set showcmd						" show partially-typed commands.
set wildmenu						" visual autocomplete for command menu
set wildignore+=*\\tmp\\*,*.swp,*.swo,*.zip,.git,.cabal-sandbox,*.class,target
set wildmode=longest,list,full
set completeopt=menuone,menu,longest                    " autocomplete related options.
set lazyredraw						" redraw only when we need to.
set showmatch						" show matching brackets
set sidescrolloff=2
highlight BoldGroup gui=bold
match BoldGroup /[\-\[\](){}.,;:=><_+*/]/
set backspace=indent,eol,start
set t_Co=256						" 256 colors
set listchars=tab:▸\ ,eol:¬,trail:•,extends:❯,precedes:❮	" Invisible characters (toggle with <,i>)
set showbreak=↪
set nolist						" Invisible characters turned off by default
set nofoldenable					" Folding disabled
set modelines=1
set autoread                                            "reload files when changed on disk

if (exists('+colorcolumn'))
    set colorcolumn=80
endi


" Show syntax highlighting groups for word under cursor
nmap <leader>sp :call <SID>SynStack()<CR>
function! <SID>SynStack()
  if !exists("*synstack")
    return
  endif
  echo map(synstack(line('.'), col('.')), 'synIDattr(v:val, "name")')
endfunc



" Spaces and Tabs

set tabstop=8 						" tab spacing (settings below are just to unify it)
set softtabstop=8
set shiftwidth=4
set expandtab
set nowrap
set smarttab 						" use tabs at the start of a line, spaces elsewhere
au FileType clojure,ruby,scala,haskell,eruby,javascript,html,css setl shiftwidth=2 softtabstop=2



" Search

set hlsearch						" highlight searched for phrases
set incsearch 						" highlight as you type you search phrase
set ignorecase      					" ignore case when searching.
set smartcase						" make case sensitive when upper-case included.
set gdefault						" substitutions to replace all matches in a line.



" Movement

" move vertically by visual line
nnoremap j gj
" move vertically by visual line
nnoremap k gk
nnoremap <space> <PageDown>
nnoremap <C-space> <PageUp>



" Misc

set shell=/bin/bash
set viminfo+=!						" make sure it can save viminfo.
set history=50						" fifty lines of command line history.
set nobackup
set noswapfile
set visualbell t_vb=					" turn off error beep/flash
set matchtime=5						" how many tenths of a second to blink matching brackets for
set matchpairs+=<:>					" have % bounce between angled brackets, as well as t'other kinds.
set laststatus=2					" always show the status line
set mouse=a						" use mouse everywhere.
set helpheight=999
" Open help in new tab
cabbrev help tab help
cabbrev h tab h



" Mappings/Shortcuts

inoremap jk <Esc>
vnoremap < <gv
vnoremap > >gv
inoremap uu _
inoremap hh =><Space>
"inoremap aa @
inoremap ii \|<Space>
inoremap >x ✗<Space>
nnoremap <leader>md <Esc>V:s/✗/✓<CR>:noh<CR>
nnoremap <leader>mn <Esc>V:s/✓/✗<CR>:noh<CR>

nnoremap <leader>fm :<C-U>call PareditFindDefunBck()<CR>V%=

nnoremap <D-1> 1gt
nnoremap <D-2> 2gt
nnoremap <D-3> 3gt
nnoremap <D-4> 4gt
nnoremap <D-0> :tablast<CR>
inoremap <D-1> <esc>1gt
inoremap <D-2> <esc>2gt
inoremap <D-3> <esc>3gt
inoremap <D-4> <esc>4gt
inoremap <D-0> <esc>:tablast<CR>


" Window management

" Jump to left window
nnoremap <C-h> <C-w>h
" Jump to right window
nnoremap <C-l> <C-w>l
" Jump to below window
"nnoremap <C-j> <C-w>j"<C-w>_
nnoremap <C-j> <C-w>j
" Jump to above window
"nnoremap <C-k> <C-w>k<C-w>_
nnoremap <C-k> <C-w>k

" Read this issue why the following is needed
" https://github.com/neovim/neovim/issues/2048
if has('nvim')
     nnoremap <BS> <C-W>h
 endif

set equalalways						" Multiple windows, when created, are equal in size
set splitbelow splitright				" Windows on splitting would be below or to the right



" Autogroups

function! <SID>StripTrailingWhiteSpaces()
    let cur_pos = getpos(".")
    %s/\s\+$//e
    call setpos(".", cur_pos)
endfun



" Language Specific

augroup configgroup
    autocmd!
    autocmd FileType haskell            :inoremap <buffer> >> -><Space>
    autocmd FileType haskell,scala      :inoremap <buffer> << <-<Space>
    autocmd BufEnter * lcd %:p:h                                        " Sets path to directory buffer was loaded from
    autocmd BufWritePre * :call <SID>StripTrailingWhiteSpaces()         " remove trailing whitespace on save
    "autocmd FocusLost * :wa                                             " saves on focus lost
    au FileType gitcommit execute "normal! O" | startinsert             " when commiting add new line and enter insert mode
augroup END

" Scala
au BufNewFile,BufRead *.sc set filetype=scala


" Plugins configuration



" ctrlp.vim
nnoremap <C-b> :CtrlPBuffer<CR>
"nnoremap <C-m> :CtrlPMRU<CR>
let g:ctrlp_user_command = ['.git/', 'git --git-dir=%s/.git ls-files -oc --exclude-standard']
"let g:ctrlp_user_command = 'ag %s -i --nocolor --nogroup --hidden --ignore .git --ignore .svn --ignore .hg --ignore .DS_Store --ignore "**/*.pyc" -g ""'
let g:ctrlp_by_filename = 1
"let g:ctrlp_regexp = 1
let g:ctrlp_mruf_relative = 1
let g:ctrlp_use_caching = 0
"let g:ctrlp_lazy_update = 1

" NerdTree
let NERDTreeHijackNetrw=1                                       " User instead of Netrw when doing an edit /foobar
let NERDTreeMouseMode=1                                         " Single click for everything
let g:NERDTreeWinPos = "left"

" vim-plug
nnoremap <leader>pi :PlugInstall<CR>
nnoremap <leader>pc :PlugClean<CR>
nnoremap <leader>pu :PlugUpdate<CR>

" Leader shortcuts

" open vimrc
nnoremap <leader>ev :tabnew $MYVIMRC <CR>
nnoremap <leader>ov :e $MYVIMRC <CR>
" source vimrc
nnoremap <leader>sv :source $MYVIMRC <CR>
" vertical split
nnoremap <leader>v :vsp^M^W^W<CR>
" horizontal split
nnoremap <leader>h :split^M^W^W<CR>
" set paste/nopaste toggle
nnoremap <leader>pp :set paste!<CR>
nnoremap <leader>r :checktime<CR>
" Toggle invisible chars
nnoremap <leader>l :set list!<CR>
" turn off search highlight
nnoremap <leader><space> :nohlsearch<CR>
" underline with dashes
nnoremap <leader>u yyp<c-v>$r-I"<ESC>

" vp doesn't replace paste buffer
function! RestoreRegister()
  let @" = s:restore_reg
  return ''
endfunction
function! s:Repl()
  let s:restore_reg = @"
  return "p@=RestoreRegister()\<cr>"
endfunction
vmap <silent> <expr> p <sid>Repl()

" EasyAlign
"nnoremap <leader>f= vip:EasyAlign=<CR>
"vnoremap <leader>f= :EasyAlign=<CR>
"nnoremap <leader>f. vip:EasyAlign/->/<CR>
"vnoremap <leader>f. :EasyAlign/->/<CR>


" Tabularize
" Align by a single colon, useful for Cabal descriptions.
nnoremap <leader>f; :Tabularize colon<CR>
" Align a set of bindings by "=".
nnoremap <leader>f= :Tabularize haskell_bindings<CR>
" Align line-comments at the end of lines.
nnoremap <leader>f- :Tabularize haskell_comments<CR>
" Align a set of monadic binds by "<-".
nnoremap <leader>f< :Tabularize haskell_do_arrows<CR>
" Align imports by import list and "as".
nnoremap <leader>fi :Tabularize haskell_imports<CR>
" Align a set of pattern matches by "->".
nnoremap <leader>f> :Tabularize haskell_pattern_arrows<CR>
" Align type signatures by "::" in a record.
nnoremap <leader>f: :Tabularize haskell_types<CR>
" Repeat the previous Tabularize
nnoremap <leader>fr :Tabularize<CR>
nnoremap <leader>f" :Tabularize / "/l0r0<CR>
nnoremap <leader>f, :Tabularize / ,/l1r0<CR>
vnoremap <leader>f= :EasyAlign-1=<CR>


" NerdTree
nnoremap <leader>n :NERDTreeTabsToggle<CR>


" Slimux
nnoremap <leader>sl :SlimuxREPLSendLine<CR>
vnoremap <leader>ss :SlimuxREPLSendSelection<CR>
nnoremap <leader>sb :SlimuxREPLSendBuffer<CR>


" Ag
nnoremap <leader>fr :Ag <cword><CR>

" vim-wheel
let g:wheel#map#up   = '<D-k>'
let g:wheel#map#down = '<D-j>'


" vim:foldmethod=marker:foldlevel=0:nofoldenable
